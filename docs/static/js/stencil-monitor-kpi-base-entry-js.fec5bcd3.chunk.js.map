{"version":3,"sources":["../node_modules/@amzn/bp-components/dist/esm-es5/getVisibleData-38130c2d.js","../node_modules/@amzn/bp-components/dist/esm-es5/number-1681647b.js","../node_modules/@amzn/bp-components/dist/esm-es5/monitor-kpi-base.entry.js"],"names":["pointBisector","bisector","p","x","getVisibleData","data","_a","includeBoundaryPoints","start","end","length","startIndex","Math","max","left","endIndex","min","right","slice","precision","num","digits","toString","split","integer","fractional","Number","parseFloat","toPrecision","TrendDirection","Arrow","h","viewBox","d","Trend","curr","prev","prevY","previousPoint","y","latestY","latestPoint","miniVersion","direction","None","Flat","Up","Down","classes","trend","down","flat","up","class","prevValue","currValue","percentage","toFixed","computePercentage","isInViewPort","point","MonitorKpiBase","hostRef","_this","this","registerInstance","isEditing","isLoading","isFetching","errorMap","getValues","dataStream","setLatestPoint","undefined","idx","viewPort","updateName","name","onChangeLabel","streamId","streamInfo","id","getFontColor","breachedThreshold","getBreachedThreshold","thresholds","color","prototype","getFontSize","height","width","render","hasError","unit","hasDataStream","main","onNameChange","dataStreamInfo","activePoint","style","fontSize","isNaN"],"mappings":"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","file":"static/js/stencil-monitor-kpi-base-entry-js.fec5bcd3.chunk.js","sourcesContent":["import { b as bisector } from './index-085eab52.js';\n// By doing the mapping to a date within the bisector\n// we eliminate the need to iterate over the entire data.\n// (As opposed to mapping entire data to an array of dates)\nvar pointBisector = bisector(function (p) { return p.x; });\n/**\n * Get Visible Data\n *\n * Returns the data points which are required for the chart to correctly render.\n * This assumes linear interpolation between points\n * TODO(btd): Support other interpolation methods\n *\n * NOTE: It's possible to have data not in the viewport which is required for the chart to render\n * it's fully visualization correctly. For Instance, even if a point isn't visible in the viewport, it may\n * be used within interpolation to calculate a path between the points which is within the viewport.\n *\n * Different interpolation methods need larger amount of context around the viewport to correctly render\n * the chart visualization.\n */\nvar getVisibleData = function (data, _a, \n// Whether we want to include a single point to the right, and to the left of the provide viewport.\n// This is useful when rendering lines since you need to connect a point to a point outside of the viewport\n// to fully render the data correctly.\nincludeBoundaryPoints) {\n    var start = _a.start, end = _a.end;\n    if (includeBoundaryPoints === void 0) { includeBoundaryPoints = true; }\n    // If there is no data\n    if (data.length === 0) {\n        return [];\n    }\n    // If all data is before the view port\n    if (start > data[data.length - 1].x) {\n        return [];\n    }\n    // If all data is after the view port\n    if (end < data[0].x) {\n        return [];\n    }\n    // Otherwise return all the data within the viewport, plus an additional single data point that falls outside of\n    // the viewport in either direction.\n    var startIndex = Math.max(pointBisector.left(data, start) - (includeBoundaryPoints ? 1 : 0), 0);\n    var endIndex = Math.min(pointBisector.right(data, end) - (includeBoundaryPoints ? 0 : 1), data.length - 1);\n    return data.slice(startIndex, endIndex + 1);\n};\nexport { getVisibleData as g, pointBisector as p };\n","var MAX_PRECISION = 3;\n/**\n * Computes the siginificant digits for a given number to the max precision\n */\nvar precision = function (num) {\n    var digits = num.toString();\n    var _a = digits.split('.'), integer = _a[0], fractional = _a[1];\n    if (num === 0)\n        return 0;\n    if (fractional == null) {\n        return num;\n    }\n    if (integer.length >= MAX_PRECISION) {\n        /**\n         * In math, any number greater than 4 should be rounded\n         */\n        var shouldRound = Number(fractional[0]) > 4;\n        return shouldRound ? Number(integer) + 1 : Number(integer);\n    }\n    return Number(Number.parseFloat(digits).toPrecision(MAX_PRECISION));\n};\nexport { precision as p };\n","import { h, r as registerInstance } from './index-326b73e4.js';\nimport './types-ef93b8eb.js';\nimport './_commonjsHelpers-17042db9.js';\nimport { g as getBreachedThreshold } from './utils-ef59b734.js';\nimport './v4-1d709f5b.js';\nimport './index-085eab52.js';\nimport './predicates-4851c065.js';\nimport { p as pointBisector } from './getVisibleData-38130c2d.js';\nimport { p as precision } from './number-1681647b.js';\nvar Arrow = function () { return (h(\"svg\", { viewBox: \"0 0 24 24\" }, h(\"path\", { d: \"M13.025 1l-2.847 2.828 6.176 6.176h-16.354v3.992h16.354l-6.176 6.176 2.847 2.828 10.975-11z\" }))); };\nvar TrendDirection;\n(function (TrendDirection) {\n    TrendDirection[\"Down\"] = \"Down\";\n    TrendDirection[\"Flat\"] = \"Flat\";\n    TrendDirection[\"None\"] = \"None\";\n    TrendDirection[\"Up\"] = \"Up\";\n})(TrendDirection || (TrendDirection = {}));\nvar getStreamDirection = function (curr, prev) {\n    if (curr == null || prev == null) {\n        return TrendDirection.None;\n    }\n    if (curr === prev) {\n        return TrendDirection.Flat;\n    }\n    return curr > prev ? TrendDirection.Up : TrendDirection.Down;\n};\nvar computePercentage = function (prevValue, currValue) {\n    var decimal = currValue / prevValue;\n    var percentage = ((decimal - 1) * 100).toFixed(1);\n    var absoluteValue = parseFloat(percentage) > 0 ? percentage : parseFloat(percentage) * -1;\n    return absoluteValue + \"%\";\n};\nvar Trend = function (_a) {\n    var prevY = _a.previousPoint.y, latestY = _a.latestPoint.y, miniVersion = _a.miniVersion;\n    var direction = getStreamDirection(latestY, prevY);\n    var classes = {\n        trend: true,\n        down: direction === TrendDirection.Down,\n        flat: direction === TrendDirection.Flat,\n        up: direction === TrendDirection.Up,\n    };\n    return (h(\"div\", { class: classes }, h(\"div\", { class: \"data\" }, h(\"div\", { class: \"direction\" }, h(Arrow, null)), h(\"div\", { \"data-testid\": \"previous-value\", class: \"value\" }, typeof prevY === 'number' && typeof latestY === 'number' ? computePercentage(prevY, latestY) : prevY)), !miniVersion && h(\"div\", { class: \"descriptor\" }, \"from previous value\")));\n};\nvar monitorKpiBaseCss = \"@-webkit-keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}*{-webkit-box-sizing:border-box;box-sizing:border-box}.main{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;position:relative;width:100%;height:100%;font-family:var(--primary-font-family)}.indicator{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;-ms-flex-pack:center;justify-content:center;-ms-flex-align:center;align-items:center;position:relative;padding-top:10px}.kpi-title{display:block;margin-bottom:10px;width:100%;text-align:center;padding:0 5px 0 5px}.value{position:relative;font-variant-numeric:tabular-nums;font-weight:400;color:var(--value-component-font-color-primary)}.unit{font-size:1.4rem;color:var(--error-badge-font-color);font-weight:var(--font-weight-light);margin-left:5px;padding-top:20px}.trend{margin-top:10px;display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;-ms-flex-pack:start;justify-content:flex-start;-ms-flex-align:center;align-items:center;position:relative;-webkit-transition:opacity 250ms ease-out;transition:opacity 250ms ease-out}.trend>.data{display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center;-ms-flex-align:center;align-items:center;position:relative;width:auto;height:1.5625rem;color:#4263a6;font-weight:400}.trend>.data>.direction{position:relative;width:1.5rem;height:1.5rem;margin-right:0.3125rem;-webkit-transform:rotate(0);transform:rotate(0);-webkit-transform-origin:center;transform-origin:center;-webkit-transition:-webkit-transform 250ms ease-out;transition:-webkit-transform 250ms ease-out;transition:transform 250ms ease-out;transition:transform 250ms ease-out, -webkit-transform 250ms ease-out}.trend>.data>.direction svg{position:absolute;width:100%;height:100%}.trend>.data>.direction svg>path{fill:var(--visualization-sequential-blues-normal-1-0)}.trend.down>.data>.direction{-webkit-transform:rotate(45deg);transform:rotate(45deg)}.trend.up>.data>.direction{-webkit-transform:rotate(-45deg);transform:rotate(-45deg)}.trend>.data>.value{position:relative;font-size:2rem;font-weight:400;line-height:1;color:var(--visualization-sequential-blues-normal-1-0);font-variant-numeric:tabular-nums;text-align:center}.trend>.descriptor{position:relative;font-size:1.4rem;font-weight:400;line-height:2rem;color:var(--value-component-font-color-tertiary);text-align:center}.loading-wrapper{height:35px;display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center}bp-loading-spinner{display:inline-block;-webkit-transform:scale(0.75);transform:scale(0.75)}bp-error-badge{font-size:1.2rem}\";\nvar MIN_WIDGET_HEIGHT = 280;\nvar MIN_WIDGET_WIDTH = 600;\nvar isInViewPort = function (point, _a) {\n    var start = _a.start, end = _a.end;\n    return point.x >= start && point.x <= end;\n};\nvar MonitorKpiBase = /** @class */ (function () {\n    function MonitorKpiBase(hostRef) {\n        var _this = this;\n        registerInstance(this, hostRef);\n        this.isEditing = false;\n        this.isLoading = false;\n        this.isFetching = false;\n        this.errorMap = {};\n        this.getValues = function (dataStream) {\n            if (!dataStream || !dataStream.data.length) {\n                _this.setLatestPoint(undefined);\n                return {\n                    latestPoint: undefined,\n                    previousPoint: undefined,\n                };\n            }\n            var idx = pointBisector.left(dataStream.data, _this.viewPort.end);\n            var latestPoint = dataStream.data[idx - 1];\n            var previousPoint = dataStream.data[idx - 2];\n            _this.setLatestPoint(latestPoint && isInViewPort(latestPoint, _this.viewPort) ? latestPoint : undefined);\n            return {\n                latestPoint: latestPoint && isInViewPort(latestPoint, _this.viewPort) ? latestPoint : undefined,\n                previousPoint: previousPoint && isInViewPort(previousPoint, _this.viewPort) ? previousPoint : undefined,\n            };\n        };\n        this.updateName = function (name) {\n            _this.onChangeLabel({\n                streamId: _this.streamInfo.id,\n                name: name,\n            });\n        };\n        this.getFontColor = function (latestPoint) {\n            var baseColor = '#000';\n            if (latestPoint == null) {\n                return baseColor;\n            }\n            var breachedThreshold = getBreachedThreshold(latestPoint.y, _this.thresholds);\n            return breachedThreshold ? breachedThreshold.color : baseColor;\n        };\n    }\n    MonitorKpiBase.prototype.getFontSize = function () {\n        if (this.height < MIN_WIDGET_HEIGHT || this.width < MIN_WIDGET_WIDTH) {\n            return '3rem';\n        }\n        return '4.5rem';\n    };\n    MonitorKpiBase.prototype.render = function () {\n        var dataStream = this.data;\n        var hasError = dataStream && this.errorMap[dataStream.id] != null;\n        var _a = this.getValues(dataStream), latestPoint = _a.latestPoint, previousPoint = _a.previousPoint;\n        var unit = this.streamInfo.unit;\n        var hasDataStream = dataStream != null && dataStream.data.length > 0;\n        return (h(\"div\", { class: { main: true, 'is-editing': this.isEditing } }, h(\"div\", { class: \"indicator\" }, hasError && h(\"bp-error-badge\", { \"data-testid\": \"warning\" }, \"Stopped\"), h(\"monitor-data-stream-name\", { class: \"kpi-title\", onNameChange: this.updateName, dataStreamInfo: this.streamInfo, activePoint: this.activePoint, isEditing: this.isEditing }), h(\"div\", { class: \"loading-wrapper\" }, this.isLoading && !hasDataStream ? (h(\"bp-loading-spinner\", { \"data-testid\": \"loading\", style: { height: this.getFontSize(), width: this.getFontSize() } })) : (h(\"div\", { \"data-testid\": \"current-value\", class: \"value\", style: { fontSize: this.getFontSize(), color: this.getFontColor(latestPoint) } }, latestPoint && !Number.isNaN(latestPoint.y)\n            ? [precision(latestPoint.y), h(\"span\", { class: \"unit\" }, unit)]\n            : '--'))), previousPoint && latestPoint && (h(Trend, { previousPoint: previousPoint, latestPoint: latestPoint, miniVersion: this.miniVersion })))));\n    };\n    return MonitorKpiBase;\n}());\nMonitorKpiBase.style = monitorKpiBaseCss;\nexport { MonitorKpiBase as monitor_kpi_base };\n"],"sourceRoot":""}